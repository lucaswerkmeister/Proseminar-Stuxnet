\documentclass{beamer}
\usepackage[utf8]{inputenc}
\usepackage{xspace}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{color}
\usepackage{inconsolata}

\usepackage{templates/beamerthemekit}
\usepackage{pdfpcnotes}

\lstdefinestyle{c}{language=C,
basicstyle=\footnotesize\ttfamily,
%commentstyle=\color{green},
%identifierstyle=\color{blue},
keywordstyle=\color{purple},
stringstyle=\color{cyan}
}

\setbeamercovered{invisible}

\titleimage{AhmadinejadNatanz_cropped_caption}

\title{Stuxnet}
\subtitle{Proseminar: Desaster in der Software-Sicherheit}
\author{Lucas Werkmeister}
\date{Januar / Februar 2015}

\begin{document}

\begin{frame}
  \titlepage
  \pnote{Begruessung}
\end{frame}

%\begin{frame}
%  \tableofcontents
%  \pnote{Gliederung}
%\end{frame}

\section{Einführung}

\subsection{Allgemeines}

\begin{frame}
  \frametitle{Allgemeines}
  \begin{itemize}
    \item Computerwurm, zwei Versionen:
      \begin{itemize}
        \item 0.5: 2007-2009
        \item 1.x: 2010
      \end{itemize}
    \item Gezielter Angriff auf iranische Uran-Anreicherungsanlage
    \item Geschätzter Entwicklungsaufwand: ca.~10~Entwickler, 6~Monate + Quality Assurance, Testen, etc.
    \item Testen erfordert Nachbau der Anlage (inkl. echtes Uran)
    \item Folgerung: Staatliche Angreifer (Annahme: USA)
  \end{itemize}
  \pnote{Hinweise (myrtus) erwaehnen, Tasten im Nebel, nicht drauf eingehen}
\end{frame}

\subsection{Urananreicherung}

\begin{frame}
  \frametitle{Urananreicherung}
  \begin{itemize}
    \item Gaszentrifugen: Gas mit schwererem Uran sammelt sich außen
    \item Sehr niedriger Druck: ca.~2-5~mbar (TKaC 26)
    \item Höhere Frequenzen: Stärkere Anreicherung, aber instabiler
    \item Im Iran: IR-1-Zentrifuge – europäisches Modell der 60er/70er
      \begin{itemize}
        \item ``obsolete design that Iran never managed to operate reliably'' (TKaC 5)
        \item Häufige Ausfälle trotz verringertem Betriebsdruck
        \item Dafür: Massenproduktion
      \end{itemize}
  \end{itemize}
  \pnote{UF6 wird bei 100mbar fest (TKaC 7)\\IR-1: Best case: nur halbe theoretische Ausbeute}
\end{frame}

\section{Physische Angriffe}

\subsection{1. Angriff}

\begin{frame}
  \frametitle{1. Angriff}
  \begin{itemize}
    \item Manipulation der Ventile an den Zentrifugen
    \item Überdruck in den Zentrifugen
    \item Während des Angriffs werden alte Sensordaten abgespielt
    \item Angriff endet \emph{bevor} irreparabler Schaden entsteht
  \end{itemize}
  \pnote{Dampfkochtopf-Analogie?\\21 Sekunden replay\\bei Pressure controllers, die Dump Line kontrollieren, wird Linearisierungs-Kalibrierung ueberschossen\\Erinnerung: 2-5mbar Betriebsdruck, fest bei 100mbar}
\end{frame}

\subsection{2. Angriff}

\begin{frame}
  \frametitle{2. Angriff}
  \begin{itemize}
    \item Manipulation der Rotorgeschwindigkeit
      \begin{itemize}
        \item Normale Betriebsgeschwindigkeit: 63000rpm (1050Hz)
        \item Erhöhte Geschwindigkeit: 84600rpm (1410Hz)
        \item Verringerte Geschwindigkeit: 120rpm (2Hz)
      \end{itemize}
    \item Leicht festzustellen (zuhören) – insbesondere, wenn synchronisiert
  \end{itemize}
  \pnote{Es werden NICHT alte Sensordaten abgespielt! Unnoetig: Konst. Geschw. erwartet, ausserdem SCADA liest Daten aus Speicher, nicht direkt aus Geraet.\\Angriff wurde via WinCC synchronisiert (unklar ob im Iran verwendet), noch leichter zu hoeren}
\end{frame}

\subsection{Steuerung der Anlage}

\begin{frame}
  \frametitle{Steuerung der Anlage}
  \begin{itemize}
    \item Anlagensteuerung durch SCADA-Software, z.~B. WinCC
    \item Irans SCADA-Software: Unbekannt, offenbar Eigenbau
      \begin{itemize}
        \item ``quite amateurish by Western standards […] custom-built […] little familiarity with contemporary SCADA software design'' (TKaC 27)
        \item Aber durchgehend Englisch, selbst mit US-Datumsformat
      \end{itemize}
    \item Direkte Steuerung erfolgt über \emph{Programmable Logic Controllers}~(PLCs)
      \begin{itemize}
        \item S7-417: Ventile und Drucksensoren (1.~Angriff)
        \item S7-315: Rotoren (2.~Angriff)
      \end{itemize}
    \item PLCs werden mit \emph{Step7} programmiert
  \end{itemize}
  \pnote{SCADA: Nur ein unwichtiges Farsi-Label gesehen}
\end{frame}

\section{IT-Angriffe}

\subsection{Verbreitung}

\begin{frame}
  \frametitle{Verbreitung}
  \begin{itemize}
    \item Step7-Projekte: Infektion der Step7-Installation beim Öffnen von infizierter Datei
    \item Memory Sticks:
      \begin{itemize}
        \item \texttt{autorun.inf}: Infektion von Windows bei Autorun oder manuellem Öffnen (Version~1.001)
        \item \texttt{.lnk}-Dateien: Infektion von Windows beim Öffnen im Explorer (Versionen~1.10x)
      \end{itemize}
    \item Netzwerk
      \begin{itemize}
        \item WinCC: Infektion des Servers, wenn möglich (Versionen~1.x)
        \item SMB: Infektion des Remote-Systems, wenn möglich (Versionen~1.x)
        \item Print Spooler: Infektion des Remote-Systems, wenn möglich (Versionen~1.x)
      \end{itemize}
  \end{itemize}
  \pnote{Beachte: 0.5 nur Step7}
\end{frame}

\subsection{Updates}

\begin{frame}
  \frametitle{Updates}
  \begin{itemize}
    \item Command and Control-Server: Rückmeldung, dann neue Executable herunterladen und ausführen
      \begin{itemize}
        \item 0.5: \url{smartclick.com}, \url{best-advertising.net}, \url{internetadvertising4u.com}, \url{ad-marketing.net}
        \item 1.x: \url{www.mypremierfutbol.com}, \url{www.todaysfutbol.com}
      \end{itemize}
    \item Peer-to-Peer Updates
      \begin{itemize}
        \item Bei jeder Neuinfektion wird zunächst auf eine vorhandene Version geprüft und, falls vorhanden, die ältere aktualisiert
        \item 0.5: Windows mailslots, file shares
        \item 1.x: RPC server + client
      \end{itemize}
  \end{itemize}
  \pnote{Domains mittlerweile alle Besitzer gewechselt\\RPC = Remote Procedure Call}
\end{frame}

\subsection{CVE-2010-2743}

\begin{frame}
  \frametitle{CVE-2010-2743 Local Privilege Escalation}
  \begin{itemize}
    \item \texttt{win32k.sys} lädt Keyboard-Layouts, läuft im Kernel-Mode
    \item Ein Index in eine Funktionspointer-Tabelle wird nicht korrekt verifiziert
    \item Stuxnet weist Windows an, eine nicht wohlgeformte Keyboard-Layout-Datei zu laden
    \item Dadurch wird Stuxnet-Code im Kernel-Mode ausgeführt
  \end{itemize}
  \pnote{0-day-exploit\\CVE = Common Vulnerabilities and Exposures}
\end{frame}

\begin{frame}
  \frametitle{Function Table}
  \lstinputlisting[language=C,style=c]{../functionPointerDemo/01-harmless.c}
  \pnote{Was passiert mit Index 2?}
\end{frame}

\begin{frame}
  \frametitle{Absturz}
  \lstinputlisting[language=C,style=c]{../functionPointerDemo/02-broken.c}
  \pnote{Segfault.\\nm zeigt: table ganz am ende, danach nur __TMC_END__.}
\end{frame}

\begin{frame}
  \frametitle{Infektion}
  \lstinputlisting[language=C,style=c]{../functionPointerDemo/03-infected.c}
  \pnote{nm zeigt: table1, table2, __TMC_END__.}
\end{frame}

\begin{frame}
  \frametitle{Absicherung}
  \lstinputlisting[language=C,style=c]{../functionPointerDemo/04-protected.c}
  \pnote{echter code: bessere fehlerbehandlung\\sizeof(table)/sizeof(table[0])}
\end{frame}

\subsection{CVE-2012-3015}

\begin{frame}
  \frametitle{CVE-2012-3015 Step7-Infektion}
  % TODO: Probably needs an improvement, a collection of quotes isn’t very interesting
  % Do we even need to look at this in detail at all? What’s the takeaway?
  \begin{itemize}
    \item ``STEP7 contains a DLL loading mechanism that can be circumvented by attackers to execute arbitrary code.'' (SSA-110665)
    \item ``Untrusted search path vulnerability […] allows local users to gain privileges via a Trojan horse DLL in a STEP7 project folder.'' (CVE-2012-3015)
    \item ``The application searches for critical resources using an externally-supplied search path that can point to resources that are not under the application's direct control.'' (CWE-426)
    \item Fix: ``The updates implement a mechanism that rejects DLLs in the STEP7 project folders which contain executable code, thus preventing unintended execution of unchecked code.'' (SSA-110665)
  \end{itemize}
  \pnote{CWE = Common Weakness Enumeration}
\end{frame}

\section{Vergleich}

\subsection{Stuxnet 0.5}

\begin{frame}
  \frametitle{Stuxnet 0.5}
  \begin{itemize}
    \item Sehr zielgerichteter und komplexer Angriff
    \item Sehr eingeschränkte Verbreitung
      \begin{itemize}
        \item Ausschließlich Step7-Infektionen
      \end{itemize}
  \end{itemize}
  \begin{figure}[p]
    \centering
    \includegraphics[width=0.8\textwidth]{../Evolution_exploits.png}
  \end{figure}
\end{frame}

\subsection{Stuxnet 1.x}

\begin{frame}
  \frametitle{Stuxnet 1.x}
  \begin{itemize}
    \item Einfacherer Angriff
    \item Breite Vielfalt an Verbreitungsmethoden, einschließlich 4~Zero-Day-Exploits
    \item Größerer Aufwand, höheres Entdeckungsrisiko; warum?
  \end{itemize}
  \begin{figure}[p]
    \centering
    \includegraphics[width=0.5\textwidth]{../Evolution_replication.png}
  \end{figure}
\end{frame}

\subsection{Defense in Depth}

\begin{frame}
  \frametitle{Defense in Depth}
  \begin{itemize}
    \item Ursprünglich militärischer Begriff
    \item Mehrere, weiträumig gestreckte Verteidigungslinien statt einer Front
    \item Verlust von etwas Gelände, dafür Dehnung des Angriffs und Schwächung der Angreifer
    \item In IT: Mehrere, redundante Sicherheits-Ebenen
    \item Vollständiger Angriff wird erschwert und kann über längeren Zeitraum besser bemerkt werden
  \end{itemize}
\end{frame}

\subsection{Stuxnet 0.5: Einfache Verbreitung}

\begin{frame}
  \frametitle{Stuxnet 0.5: Einfache Verbreitung}
  \begin{itemize}
    \item Stuxnet 0.5 kam mit nur einer Verbreitungsmethode ans Ziel
    \item Vermutlich durch Subunternehmer eingebracht
      \begin{itemize}
        \item Entwicklung benötigte auch detaillierte Informationen über Anlage:
          ``whoever provided the required intelligence may as well know the favorite pizza toppings of the local head of engineering'' (TKaC 10)
      \end{itemize}
      \begin{itemize} % causes pdfpc to crash if put into the previous itemize
        \item Weiteres Beispiel von Sicherheitslücke durch Subunternehmer? \pause Edward Snowden
      \end{itemize}
  \end{itemize}
  \pnote{Snowden: Booz Allen Hamilton; Sysadmin bei NSA, über sämtlichen Clearance-Stufen}
\end{frame}

\subsection{Stuxnet 1.x: Mehrstufige Verbreitung}

\begin{frame}
  \frametitle{Stuxnet 1.x: Mehrstufige Verbreitung}
  \begin{itemize}
    \item Zugangsweg von 0.5 vermutlich nicht mehr verfügbar
    \item Stuxnet 1.x musste sich ``durchhangeln''
  \end{itemize}
\end{frame}

\section{Abschluss}

\subsection{Erfolg von Defense in Depth}

\begin{frame}
  \frametitle{Erfolg von Defense in Depth}
  \begin{itemize}
    \item Stuxnet 0.5\dots
      \begin{itemize}
        \item Mindestens ab November 2005 in Entwicklung
        \item Mindestens ab November 2007 ``in freier Wildbahn'' (bei Malware-Scanning-Service hochgeladen)
        \item Wird zum 4. Juli 2009 inaktiv
        \item Erst 2013 als Vorgänger von Stuxnet erkannt
      \end{itemize}
    \item Stuxnet 1.x\dots
      \begin{itemize}
        \item Ab Juni 2009 im Umlauf
        \item Version mit signiertem Treiber ab Januar 2010 im Umlauf
        \item Juni 2010 entdeckt
        \item Juli-September 2010 bekämpft
      \end{itemize}
  \end{itemize}
  \pnote{2005: Domain registriert\\Beachte: 1.x vor Entdeckung im Umlauf, 2007 vmtl zu spät}
\end{frame}

\subsection{Quellen}

\begin{frame}
  \frametitle{Quellen}
  \fontsize{6pt}{7.2}\selectfont
  \begin{itemize}
    \item Dossier: Symantec Security Response, W32.Stuxnet Dossier, \url{https://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/w32_stuxnet_dossier.pdf}
    \item 0.5: Symantec Security Response, Stuxnet 0.5: The Missing Link, \url{https://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/stuxnet_0_5_the_missing_link.pdf}
    \item TKaC: Ralph Langner, To Kill a Centrifuge, \url{http://www.langner.com/en/wp-content/uploads/2013/11/To-kill-a-centrifuge.pdf}
    \item CVE-2010-2743: \url{https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-2743}
    \item CVE-2012-3015: \url{https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-3015}
    \item CWE-426: \url{http://cwe.mitre.org/data/definitions/426.html}
    \item SSA-110665: \url{https://www.siemens.com/innovation/pool/de/forschungsfelder/siemens_security_advisory_ssa-110665.pdf}
    \item Diese Folien sind auch verfügbar unter \url{https://github.com/lucaswerkmeister/Proseminar-Stuxnet}.
  \end{itemize}
  \pnote{Weg damit}
\end{frame}

\end{document}
